!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.AlgoFrame=i():t.AlgoFrame=i()}(self,(()=>(()=>{"use strict";var t={d:(i,e)=>{for(var s in e)t.o(e,s)&&!t.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:e[s]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{default:()=>r});const e={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};class s{constructor(t,i,s,r,a=null,h=!1){if(this.easing="function"!=typeof s?e[s]:s,this.starttime=i,this._starttime=i,this.duration=t,this.startafterwait=null,this.startanimationtime=null,this.stop=!1,this._start=new Promise((t=>this.__start=t)),!(r instanceof n))throw new Error("Invalid Keyframes Object!");this.keyframes=r,this.done=!1,this.next=void 0,this._FPS=a,this.frameDelay=1e3/this._FPS,this.frameRate=0,this.frame=-1,this.animationFrame=-1,this.loop=h}get FPS(){return this._FPS?1e3/this._FPS:null}set FPS(t){const i=parseFloat(t);if(!i)throw new Error("Not a valid Number");this._FPS=i,this.frameDelay=1e3/i}nextTime(){this._running.length||(this._next=null,this.timelineEnd=!0),this.timelineEnd||(this._next=this._running.reduce(((t,i)=>i.time<t?i:t)))}save(t,i){this.callback=t,this.precision=i}timeline(t,i){this._timeline=[],this._running=[],this.timelineEnd=!1,t.forEach((t=>{this._timeline.push({_:new s(t.duration,t.delay?t.delay:0,t.easing?t.easing:this.easing,t.keyframes?t.keyframes:this.keyframes,this._FPS).finally(t.finally),time:t.time,callback:t.run})}));let e=t.reduce(((t,i,e)=>t+i.duration||0+i.delay||0),0);return console.log(e),this.duration!==e&&(this.duration=e),this._timeline.forEach((t=>this._running.push(t))),this.nextTime(),this.callback=function(t,e,s){i(t,e,s),this._next&&e>=this._next.time&&(this._next._.startanimationtime=s.timestamp+this._next._._starttime,console.log(this._next._.starttime,s.timestamp),this._next._.run(this._next.callback),this._running.shift(),this.nextTime())},this}run(t,i=this._FPS){let e,s;this.callback=t||this.callback,this.timelineEnd=!1;class n{constructor(t=1){this.history=new Array(t).fill(0),this.last=0,this.currenttime=0}refresh(t){this.history.unshift(0),this.history.pop(),this.history[0]=t-this.currenttime,this.last=this.history.includes(0)?"Calculating...":this.history.reduce(((t,i)=>t+i))/this.history.length,this.currenttime=t}}const r=new n;isNaN(i)&&(console.log(new Error(`${i} is NaN`)),i=this._FPS,isNaN(this.precision)||(i=this.precision));const a=new n(i);return requestAnimationFrame(function n(h){this.done&&(this.frame=-1,this.starttime=this._starttime,this._timeline&&(this._timeline.forEach((t=>this._running.push(t))),this.nextTime()),this.done=!1),this._FPS?(s=Math.floor((h-this.starttime)/this.frameDelay),e=Boolean(s>this.frame)):e=!0,r.refresh(h);const o=h-this.startanimationtime;let m=o/this.duration;m>1&&(m=1);const l=this.easing(m);if(this.startanimationtime||0!==this.starttime){if(this.starttime>0)return this.startanimationtime=h,this.starttime=this.starttime-r.last<.7*r.last?0:this.starttime-r.last,void requestAnimationFrame(n.bind(this))}else this.starttimeBefore=h,this.startanimationtime=h;let u=!1;e&&(this.frame=s,this.animationFrame++,a.refresh(h),u=!0,this.callback(this.keyframes.test(Math.min(l,1)),l,{lastFrame:a.last,currentTime:a.currentTime,frame:this.animationFrame,timestamp:h})),this.stop||(o<this.duration?requestAnimationFrame(n.bind(this)):o-.9*r.last<this.duration&&!u?(this.animationFrame++,this.callback(this.keyframes.next.val,1,{lastFrame:a.last,currentTime:a.currenttime,frame:this.animationFrame,timestamp:h}),this.done=!this.done,this.loop&&this.run(t,i),this.next?.()):(this.done=!this.done,this.loop&&this.run(t,i),this.next?.())),0===this.animationFrame&&this.__start()}.bind(this)),this}finally(t){return this.next=t,this}break(){return this.stop=!1,this}listen(t,i){"start"===t&&this._start.then(i)}}class n{constructor(t,i){this.keyframes=[],t.every(((t,i)=>t instanceof n.keyframe&&!this.keyframes.some((i=>i.time===t.time))?(this.keyframes.push(t),!0):(console.error(new Error(`Invalid Keyframe ${i+1}!`)),!1))),this.easing="function"!=typeof i?e[i]:i}nextTime(){this.keyframes.length||(this.next=null),this.current=this.keyframes.reduce(((t,i)=>i.time<t?i:t)),this.next=this.keyframes.filter((t=>t.time!==this.current.time)).reduce(((t,i)=>i.time<t?i:t))}test(t){return this.nextTime(),this.current.val+(this.next.val-this.current.val)*(this.next.time-this.current.time)*Math.min(this.easing(t),1)}static keyframe=class{constructor(t,i){this.time=t,this.val=i}}}const r=s;return i})()));