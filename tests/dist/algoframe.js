!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AlgoFrame=t():e.AlgoFrame=t()}(self,(()=>(()=>{"use strict";var e={267:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Animate=void 0;const r=i(22);t.Animate=class{constructor(e){this.frame=new r.Framer,this.control=new r.Controller,this.progress=0,this.engine=new r.Animator(this);const{sequence:t,easing:i,controls:n,timing:s}=e;this.engine.easing=(0,r.passPreset)(i||"linear"),this.frame.sequence=t,(null==n?void 0:n.FPS)&&(this.frame.FPS=n.FPS),(null==n?void 0:n.loop)&&(this.control.loop=n.loop),this.frame.start.time=s.delay,this.frame.duration=s.duration||t.duration}finally(e){return this.control.finally=e,this}break(){return this.control.stop=!1,this}precision(e){return this.frame.precision=e,this}run(e){let t,i;if(e&&(this.control.callback=e),!this.control.callback)throw new Error("Main callback is required for the animation");function n(e){this.control.completed&&(this.frame.frame=-1,this.frame.start.animationTime=e,this.control.completed=!this.control.completed),this.frame._FPS?(i=Math.floor((e-this.frame.start.time)/this.frame.delay),t=Boolean(i>this.frame.count)):t=!0,this.frame.last.time.refresh(e)}return this.frame.last.time=new r.Refresher,this.frame.last.frameRate=this.frame.last.frameRate?this.frame.last.frameRate:new r.Refresher(this.frame.precision),requestAnimationFrame(function e(r){let s,a,o;if(n.call(this,r),this.frame.start.animationTime)s=r-this.frame.start.animationTime,a=s/this.frame.duration,o=this.engine.easing(a),this.progress=o,this.engine.engine({relativeProgress:a,easedProgress:o,runtime:s,timestamp:r,seg:i,condition:t,requestAnimation:e});else if(this.frame.start.time>0){this.frame.start.animationTime=r;let t=0;return"number"==typeof this.frame.last.time.last&&(t=this.frame.last.time.last),this.frame.start.time=this.frame.start.time-t<.7*t?0:this.frame.start.time-t,void requestAnimationFrame(e.bind(this))}}.bind(this)),this}}},103:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),t.Sequence=t.KeyChanger=void 0;const s=i(22),a=i(148);n(i(148),t);class o{constructor(e,t="linear",i){this.keyframes=i,this.next=null,this.current=null,this.adaptative=!1,this.object=Symbol(),this.duration="number"==typeof e?Math.floor(e):(e=>(this.adaptative=!0,1))(),this.run=[],this.easing=(0,s.passPreset)(t),this.init(i)}nextTime(){var e;this.run.length?(this.run.length>1?(this.current=this.run.reduce(((e,t)=>t.time(this.duration)<e.time(this.duration)?t:e)),this.next=this.run.filter((e=>e.time(this.duration)!==this.current.time(this.duration))).reduce(((e,t)=>t.time(this.duration)<e.time(this.duration)?t:e))||this.current):this.restart(),null===(e=this.changer)||void 0===e||e.call(this),this.run.shift()):this.next=null}restart(){for(;this.run.length;)this.run.pop();this.reset()}currentAsSequence(e,t,i){const r=(t-e.time(1))/(i-e.time(1));let n;if(r<=1)return n=e.obj.test(r,void 0,!0),n}static lerp(e,t,i){return e*(1-i)+t*i}test(e,t=!1,i=!1,r){e=e<=1?e:1;let n=r||this.next;if(this.adaptative&&!i)throw new Error("Adaptitive timed sequences cannot be played in first place");if(t&&!i)e*=this.duration;else if(t)throw new Error("miliseconds mode not allowe when adaptative");if(n&&this.current){for(;n.time(1)<=e&&1!==n.time(1);)this.nextTime(),n=this.next;if((0,a.isSimple)(n)&&(0,a.isSimple)(this.current)){e=Math.min(this.easing(e),t?this.duration:1);const i=n.time(1)-this.current.time(1),r=e<e-i?e/i:(e-this.current.time(1))/i;return o.lerp(this.current.value,n.value,n.hold?0:r)}if((0,a.isComplex)(n)&&(0,a.isSimple)(this.current)){const t=new a.valueKeyframe(this.getAbsoluteStartValue(n.obj),n.time(1),"ratio");return t.duration=this.duration,this.test(e,void 0,void 0,t)}if((0,a.isComplex)(this.current)&&(0,a.isComplex)(n))return this.currentAsSequence(this.current,e,this.next?this.next.time(1):1);if((0,a.isComplex)(this.current)&&((0,a.isSimple)(n)||!n))return this.currentAsSequence(this.current,e,n?n.time(1):1)}}getAbsoluteStartValue(e){let t=e.current;for(;t instanceof a.nestedKeyframe;)t=e.current;return t.value}getAbsoluteEndKeyframe(e){let t=e.run[e.run.length-1];for(;t instanceof a.nestedKeyframe;)t=e.run[e.run.length-1];return t}}t.KeyChanger=o;class u extends o{constructor(e,t,i="linear",r=null){super(e,i,t),this.keyframes=t,this.callback=r,this.type="simple",this.taken=[]}init(e){this.type="simple",e.forEach((e=>{"ratio"==e.type&&(e.timing=e.timing*this.duration,e.type="miliseconds")})),this.taken=[];const t=e[0],i=e[e.length-1];if(t.duration=this.duration,i.duration=this.duration,t.time(1)>0){const e=t instanceof a.valueKeyframe?new a.valueKeyframe(t.value,0):new a.nestedKeyframe(t.obj,0);e.duration=this.duration,this.keyframes.unshift(e),this.run.push(e)}if(i.time(1)<1){if(i instanceof a.nestedKeyframe)throw new Error("Cannot set last keyframe as nested sequence, it's impossible");const e=new a.valueKeyframe(i.value,1,"ratio");e.duration=this.duration,this.keyframes.push(e),this.run.push(e)}if(this.keyframes.forEach(((e,t)=>{e.duration=this.duration;const i=e.time(this.duration);if(i>this.duration)throw new Error("Keyframe timing overflow");if(this.taken.includes(i))throw new Error("It must not have repeated times");this.taken.push(e.time(1)),e instanceof a.nestedKeyframe&&(this.type="nested"),this.run.push(e)})),!this.type)throw new Error("No events/keyframes provided");this.keyframes[0],a.valueKeyframe;try{this.nextTime()}catch(e){throw new Error("Identical time signatures on keyframes are not allowed on a single animation channel")}}static passKeyframe(e){return e instanceof a.nestedKeyframe||e instanceof a.valueKeyframe?e:this.is_value(e)?new a.valueKeyframe(e.value,e.timing,e.type):new a.nestedKeyframe(e.obj,e.timing,e.type)}static is_value(e){return"val"in e}addKeyframes(e="push",...t){t.forEach((t=>{const i=u.passKeyframe(t);this.keyframes[e](i)}));const{max:i}=(0,a.timeIntervals)(this.keyframes);return this.keyframes.forEach((e=>{"ratio"==e.type&&(e.timing=e.timing*i,e.type="miliseconds")})),this.duration=i,this.init(this.keyframes),this}extendToSequence(e,t){if(e.object===this.object)throw new Error("Cannot reextend to my own self");let i=2*t.value;return i=i||0,i&&(e.duration+=1),e.keyframes.forEach(((r,n)=>{const s=n<e.keyframes.length-1?1:0,a=i?s:0;r.timing=r.timing+(r.duration+this.duration+a*i)*(r.duration/(this.duration+r.duration)),r.duration+=this.duration,!s&&t&&(r.timing+=1)})),t&&!i&&this.keyframes.pop(),this.keyframes.forEach((e=>{e.duration+=this.duration})),this.keyframes.forEach((e=>{console.log(e.duration)})),this.addKeyframes("push",...e.keyframes),this}reset(){this.keyframes.forEach((e=>this.run.push(e)))}clone(){const e=this.keyframes.map((e=>{if((0,a.isComplex)(e)){const t=(0,a.replicate)(e);return t.obj=t.obj.clone(),t}return(0,a.replicate)(e)}));return new u(this.duration,e,this.easing,this.callback)}}t.Sequence=u},148:(e,t)=>{function i(e,t,i){return e*i+t}Object.defineProperty(t,"__esModule",{value:!0}),t.isComplex=t.isSimple=t.nestedKeyframe=t.valueKeyframe=t._keyframe=t.ratioAndMilisecons=t.replicate=t.timeIntervals=void 0,t.timeIntervals=function(e){let t=1,i=0;return e.map(((r,n)=>{let s=0;function a(e){return e.start?e.start:0+e.time()}const o=a(r);if(n<e.length-1&&(s=a(e[n+1])-o-1,s<r.delay))throw new Error("Sequences/_keyframe(s) overlapping on the same channel!");const u=r.start?r.start:0+o+s;return t=t<u?u:t,i=i>o?o:i,[o,u]})),{max:t,min:i}},t.replicate=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)},t.ratioAndMilisecons=i;class r{constructor(e,t="ratio",i=0,n=!1,s=0){if(this.timing=e,this.type=t,this.delay=i,this.hold=n,this.start=s,s<0)throw new RangeError("Negative start times are not implemented yet");this.id=r.instances++,"miliseconds"===this.type&&(this.duration=0)}time(e=this.duration){let t=this.timing;if(this.delay){if("number"!=typeof this.duration)throw new Error("Keyframe with delay has to have duration setted");t="ratio"===this.type?i(t,this.delay,this.duration):t+this.delay}if("number"!=typeof this.duration)throw new Error("Need to set this.duration to each keyframe in the keyframes manager");return"miliseconds"===this.type?t/(0===this.duration?1:this.duration/e):e*t}}r.instances=0,t._keyframe=r,t.valueKeyframe=class extends r{constructor(e,t,i="miliseconds",r,n=!1){super(t,i,r,n),this.value=e}},t.nestedKeyframe=class extends r{constructor(e,t,i="miliseconds",r){super(t,i,r),this.obj=e}},t.isSimple=function(e){return"value"in e&&e instanceof r},t.isComplex=function(e){return"obj"in e&&e instanceof r}},503:function(e,t,i){var r=this&&this.__rest||function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]])}return i};Object.defineProperty(t,"__esModule",{value:!0});const n=i(267),s=i(103),a=new s.Sequence(!1,[new s.valueKeyframe(2222,0,"ratio"),new s.valueKeyframe(4444,.5,"ratio"),new s.valueKeyframe(6666,1,"ratio")]),o=new s.Sequence(!1,[new s.nestedKeyframe(a.clone(),0,"ratio"),new s.nestedKeyframe(a.clone(),.5,"ratio"),new s.nestedKeyframe(a.clone(),1,"ratio")]),u=new s.Sequence(1e3,[new s.nestedKeyframe(o.clone(),0,"ratio"),new s.nestedKeyframe(o.clone(),.5,"ratio"),new s.nestedKeyframe(o.clone(),1,"ratio")]),l=function(){let e=0;return function(t){e++,new n.Animate({sequence:t,easing:"linear",timing:{delay:300}}).run((t=>{var{value:i}=t,n=r(t,["value"]);console.log("Animation "+e),console.log(i,[...Object.values(n)])}))}}();console.log(u,u.duration,"duration");let h=2;const m=({duration:e})=>(h++,new s.valueKeyframe(2222*(h%3/3*3+1),e+1,"miliseconds",200));for(let e=0;e<3;e++)u.addKeyframes("push",m(u));console.log(u.duration,"duration",u.keyframes.map((e=>[e.time(1),e.duration]))),console.log(u.addKeyframes("push",m({duration:u.duration+200})).keyframes.map((e=>[e.time(1),e.duration]))),console.error("FROM HERE"),console.log(u.keyframes.map((e=>[e.time(e.duration),e.duration,e.value]))),l(u)},22:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Animator=t.Refresher=t.Controller=t.Initiator=t.Framer=t.passPreset=t.EasingFunctions=void 0;class i{}i.linear=e=>e,i.easeInQuad=e=>e*e,i.easeOutQuad=e=>e*(2-e),i.easeInOutQuad=e=>e<.5?2*e*e:(4-2*e)*e-1,i.easeInCubic=e=>e*e*e,i.easeOutCubic=e=>--e*e*e+1,i.easeInOutCubic=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,i.easeInQuart=e=>e*e*e*e,i.easeOutQuart=e=>1- --e*e*e*e,i.easeInOutQuart=e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,i.easeInQuint=e=>e*e*e*e*e,i.easeOutQuint=e=>1+--e*e*e*e*e,i.easeInOutQuint=e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,t.EasingFunctions=i,t.passPreset=function(e){return"function"!=typeof e?i[e]:e},t.Framer=class{constructor(){this._FPS=null,this.rate=0,this.count=-1,this.frame=-1,this._precision=30,this.start=new r}set precision(e){e=Math.abs(e),this._precision=e}get precision(){return this._precision||this._FPS}set FPS(e){try{e=Math.abs(e),this._FPS=e}catch(e){}}get FPS(){return this._FPS?1e3/this._FPS:null}get delay(){if(!this._FPS)throw new Error("Not initialized");return 1e3/this._FPS}};class r{constructor(){this.time=0,this.afterWait=null,this.animationTime=null}}t.Initiator=r,t.Controller=class{constructor(){this.stop=!1,this.__start=new Promise((e=>this._start=e)),this.loop=!1}get completed(){return this._completed||!this.stop}set completed(e){this._completed=e}},t.Refresher=class{constructor(e=1){this.history=new Array(e).fill(0),this.last=0,this.currenttime=0}refresh(e){this.history.unshift(0),this.history.pop(),this.history[0]=e-this.currenttime,this.last=this.history.includes(0)?"Calculating...":this.history.reduce(((e,t)=>e+t))/this.history.length,this.currenttime=e}},t.Animator=class{constructor(e){this.origin=e}engine(e){var t,i,r,n;let s=!1;function a(){s=!0,o.frame.value=o.frame.sequence.test(Math.min(e.easedProgress,1)),o.control.callback(o.frame)}let o=this.origin;e.condition&&(o.frame.count=e.seg,o.frame.start.animationTime="number"==typeof o.frame.start.animationTime?o.frame.start.animationTime+1:o.frame.start.animationTime,o.frame.last.frameRate.refresh(e.timestamp),a()),o.stop||(e.runtime<o.duration?requestAnimationFrame(e.requestAnimation.bind(o)):e.runtime+o.last.last>o.duration?(o.animationFrame++,a(),o.control.completed=!0,o.loop&&requestAnimationFrame(e.requestAnimation.bind(o)),null===(i=(t=o.control).finally)||void 0===i||i.call(t)):o.done||(o.control.completed=!0,o.loop&&requestAnimationFrame(e.requestAnimation.bind(o)),null===(n=(r=o.control).finally)||void 0===n||n.call(r))),0===o.animationFrame&&o.__start()}}}},t={};return function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(503)})()));
//# sourceMappingURL=algoframe.js.map