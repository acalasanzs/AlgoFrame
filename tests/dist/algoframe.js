!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AlgoFrame=e():t.AlgoFrame=e()}(self,(()=>(()=>{"use strict";var t={784:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChannelsTimeline=e.Sequence=e.nestedKeyframe=e.valueKeyframe=void 0;const s=i(626);class n{constructor(t,e="ratio",i){this.timing=t,this.type=e,this.delay=i,this.id=n.instances++}time(t){if(this.delay){if(!this.duration)throw new Error("Keyframe with delay has to have duration setted");this.timing="ratio"===this.type?function(t,e,i){return t*i+e}(this.timing,this.delay,this.duration):this.timing+this.delay}if(!this.duration)throw new Error("Need to set this.duration to each keyframe in the keyframes manager");return"miliseconds"===this.type?this.timing/(this.duration/t):t*this.timing}}n.instances=0;class r extends n{constructor(t,e,i="miliseconds"){super(e,i),this.value=t}}e.valueKeyframe=r;class a extends n{constructor(t,e,i="miliseconds"){super(e,i),this.obj=t}}e.nestedKeyframe=a;class h{constructor(t,e="linear"){this.next=null,this.current=null,this.adaptative=!1,this.duration="number"==typeof t?Math.floor(t):(t=>(this.adaptative=!0,1))(),this.run=[],this.easing=(0,s.passPreset)(e)}nextTime(){var t;this.run.length?(this.run.length>1?(this.current=this.run.reduce(((t,e)=>e.time(this.duration)<t.time(this.duration)?e:t)),this.next=this.run.filter((t=>t.time(this.duration)!==this.current.time(this.duration))).reduce(((t,e)=>e.time(this.duration)<t.time(this.duration)?e:t))||this.current,console.log(null===(t=this.current)||void 0===t?void 0:t.time(1),this.next.time(1),this.run)):this.restart(),this.run.shift()):this.next=null}passKeyframe(t){return t instanceof a||t instanceof r?t:this.is_value(t)?new r(t.value,t.timing,t.type):new a(t.obj,t.timing,t.type)}is_value(t){return"val"in t}restart(){for(;this.run.length;)this.run.pop();this.reset()}static lerp(t,e,i){return t*(1-i)+e*i}test(t,e=!1,i=!1,s){t=t<=1?t:1;let n=s||this.next;if(this.adaptative&&!i)throw new Error("Adaptitive timed sequences cannot be played in first place");if(e&&!i)t*=this.duration;else if(e)throw new Error("miliseconds mode not allowe when adaptative");if(n&&this.current){for(;n.time(1)<=t&&1!==n.time(1);)this.nextTime(),n=this.next;if(n instanceof r&&this.current instanceof r){t=Math.min(this.easing(t),e?this.duration:1);const i=n.time(1)-this.current.time(1),s=t/i;return h.lerp(this.current.value,n.value,t<t-i?s:(t-this.current.time(1))/i)}if(n instanceof a&&this.current instanceof r){const e=new r(this.getAbsoluteStartValue(n.obj),n.time(1),"ratio");return e.duration=this.duration,this.test(t,void 0,void 0,e)}if(this.current instanceof a&&n instanceof a)return this.nextTime(),this.currentAsSequence(this.current,t,this.next?this.next.time(1):1);if(this.current instanceof a&&(n instanceof r||!n))return this.currentAsSequence(this.current,t,n?n.time(1):1)}}getAbsoluteStartValue(t){let e=t.current;for(;e instanceof a;)e=t.current;return e.value}getAbsoluteEndKeyframe(t){let e=t.run[t.run.length-1];for(;e instanceof a;)e=t.run[t.run.length-1];return e}}e.Sequence=class extends h{constructor(t,e,i="linear"){super(t,i),this.keyframes=e,this.type="simple",this.taken=[];const s=this.passKeyframe(e[0]),n=this.passKeyframe(e[e.length-1]);if(s.duration=this.duration,n.duration=this.duration,s.time(1)>0){const t=s instanceof r?new r(s.value,0):new a(s.obj,0);t.duration=this.duration,this.keyframes.unshift(t),this.run.push(t)}if(n.time(1)<1){if(n instanceof a)throw new Error("Cannot set last keyframe as nested sequence, it's impossible");const t=new r(n.value,1,"ratio");t.duration=this.duration,this.keyframes.push(t),this.run.push(t)}if(this.keyframes.forEach(((t,e)=>{t.duration=this.duration;const i=(t=this.passKeyframe(t)).time(this.duration);if(i>this.duration)throw new Error("Keyframe timing overflow");if(this.taken.includes(i))throw new Error("It must not have repeated times");this.taken.push(t.time(1)),t instanceof a&&(this.type="nested"),this.run.push(t)})),!this.type)throw new Error("No events/keyframes provided");this.keyframes[0];try{this.nextTime()}catch(t){throw new Error("Identical time signatures on keyframes are not allowed on a single animation channel")}}addKeyframe(t){return this}replaceKeyframe(t){return this}currentAsSequence(t,e,i){const s=(e-t.time(1))/(i-t.time(1));let n;if(s<=1.05)return n=t.obj.test(s,void 0,!0),n}reset(){this.keyframes.forEach((t=>this.run.push(this.passKeyframe(t))))}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}},e.ChannelsTimeline=class extends h{constructor(t,e,i="linear"){super(t,i),this.channels=e}currentAsSequence(t,e){}reset(){}}},494:function(t,e,i){var s=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&s(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const a=r(i(100)),h=r(i(784));let o=new a.Keyframes([new a.Keyframes.keyframe(0,0),new a.Keyframes.keyframe(1,1)],"linear");const u=new h.Sequence(1e3,[new h.valueKeyframe(0,.2,"ratio"),new h.valueKeyframe(10,.5,"ratio"),new h.valueKeyframe(50,1,"ratio")]);o=new h.Sequence(1e3,[new h.valueKeyframe(100,0,"ratio"),new h.nestedKeyframe(u,.5,"ratio"),new h.valueKeyframe(50,.75,"ratio"),new h.valueKeyframe(100,.9,"ratio")]),window.anim=new h.Sequence(1e3,[new h.valueKeyframe(100,0,"ratio"),new h.nestedKeyframe(u,.5,"ratio"),new h.valueKeyframe(50,.75,"ratio"),new h.valueKeyframe(100,.9,"ratio")]),new a.AlgoFrame(1e3,500,"linear",o).run(((t,e)=>{console.log(t,(100*e).toFixed(1))}))},626:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.passPreset=e.EasingFunctions=void 0;class i{}e.EasingFunctions=i,i.linear=t=>t,i.easeInQuad=t=>t*t,i.easeOutQuad=t=>t*(2-t),i.easeInOutQuad=t=>t<.5?2*t*t:(4-2*t)*t-1,i.easeInCubic=t=>t*t*t,i.easeOutCubic=t=>--t*t*t+1,i.easeInOutCubic=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,i.easeInQuart=t=>t*t*t*t,i.easeOutQuart=t=>1- --t*t*t*t,i.easeInOutQuart=t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,i.easeInQuint=t=>t*t*t*t*t,i.easeOutQuint=t=>1+--t*t*t*t*t,i.easeInOutQuint=t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,e.passPreset=function(t){return"function"!=typeof t?i[t]:t}},100:(t,e,i)=>{i.r(e),i.d(e,{AlgoFrame:()=>n,Keyframes:()=>r});const s={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:(4-2*t)*t-1,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t};class n{constructor(t,e,i,n,r=null,a=!1){this.easing="function"!=typeof i?s[i]:i,this.starttime=e||0,this._starttime=this.starttime,this.duration=t,this.startafterwait=null,this.startanimationtime=null,this.stop=!1,this._start=new Promise((t=>this.__start=t)),this.keyframes=n,this.done=!1,this.next=void 0,this._FPS=r,this.frameDelay=1e3/this._FPS,this.frameRate=0,this.frame=-1,this.animationFrame=-1,this.loop=a}get FPS(){return this._FPS?1e3/this._FPS:null}set FPS(t){const e=parseFloat(t);if(!e)throw new Error("Not a valid Number");this._FPS=e,this.frameDelay=1e3/e}nextTime(t=this._running){return t.length||console.log(new Error),t.reduce(((t,e)=>e.time<t.time?e:t))}save(t,e){this.callback=t,this.precision=e}restartKeyframes(t){this._timeline.forEach((t=>{t.id!==this._current.id&&(t._.keyframes.restart(),t._.keyframes.nextTime(),t.running=!1)}))}restartTimeline(){this._timeline.forEach((t=>this._running.push(t))),this._next=this.nextTime()}timeline(t,e,i){this._timeline=[],this._running=[];let s=[];t.forEach((t=>{if(t.time>=1||t.time<0||isNaN(t.time))throw new Error("Not valid");s.push({_:new n(t.duration,t.delay?t.delay:0,t.easing?t.easing:this.easing,t.keyframes?t.keyframes.clone():this.keyframes.clone(),this._FPS).finally(t.finally),time:t.time,callback:t.run})}));let r=t.reduce(((t,e)=>t+e.duration||0+e.delay||0),0);r/t[t.length-1].time<t[t.length-1].duration&&(this.duration+=t[t.length-1].duration-r/t[t.length-1].time),this.duration<r&&(this.duration=r);const a=s.length;for(let t=0;t<a;t++){const e=this.nextTime(s);e.id=t+1,e._.id=t+1,this._timeline.push(e),s.splice(s.indexOf(this._timeline[t]),1)}this.saved_timeline=this._timeline.map((t=>t.time)),this.restartTimeline();let h=this._next,o=this._timeline.reduce(((t,e)=>e.time>t.time?e:t));return this.reversed=!1,this.callback=function(t,s,n){e(t,s,n);const r=()=>{this._next._.startanimationtime=n.timestamp+this._next._._starttime,this._next._.waiting=!0,this._next._.time=this._next.time,this._next._.run(this._next.callback),this._next.running=!0,this._current=this._next,this._running.shift(),console.log(this._next.time,this._running.map((t=>t.time))),this._running.length&&(this._next=this.nextTime())};if(this._next)s>=this._next.time&&!this._next.running&&r();else{for(console.log("REVERSED"),i&&!this.reversed?this._timeline.forEach(((t,e)=>{t.time=this.saved_timeline[this.saved_timeline.length-(e+1)]-this.nextTime(this.saved_timeline)})):i&&this._timeline.forEach(((t,e)=>t.time=this.saved_timeline[e]));this._running.length;)this._running.shift();this.restartTimeline(),this.restartKeyframes(),i&&!this.reversed&&this._running.reverse(),this.reversed=!this.reversed,h=this._next,o=this._timeline.reduce(((t,e)=>e.time>t.time?e:t)),this._running.shift(),this._next=this.nextTime(),r()}},this}run(t,e=this._FPS){let i,s;this.callback=t||this.callback;class n{constructor(t=1){this.history=new Array(t).fill(0),this.last=0,this.currenttime=0}refresh(t){this.history.unshift(0),this.history.pop(),this.history[0]=t-this.currenttime,this.last=this.history.includes(0)?"Calculating...":this.history.reduce(((t,e)=>t+e))/this.history.length,this.currenttime=t}}return this.last=new n,isNaN(e)&&(console.log(new Error(`${e} is NaN`)),e=this._FPS,isNaN(this.precision)||(e=this.precision)),this.lastFrameRate=this.lastFrameRate?this.lastFrameRate:new n(e),requestAnimationFrame(function t(e){this.done&&(this.frame=-1,this.startanimationtime=e,this.done=!1,this._next=null),this._FPS?(s=Math.floor((e-this.starttime)/this.frameDelay),i=Boolean(s>this.frame)):i=!0,this.last.refresh(e);const n=e-this.startanimationtime;let r=n/this.duration;const a=this.easing(r);if(this.progress=a,this.startanimationtime||0!==this.starttime){if(this.starttime>0)return this.startanimationtime=e,this.starttime=this.starttime-this.last.last<.7*this.last.last?0:this.starttime-this.last.last,void requestAnimationFrame(t.bind(this))}else this.startanimationtime=e;let h=!1;i&&(this.frame=s,this.animationFrame++,this.lastFrameRate.refresh(e),!0,this.callback(this.waiting?0:this.keyframes.test(Math.min(a,1)),Math.min(a,1),{lastFrame:this.lastFrameRate.last,currentTime:this.lastFrameRate.currentTime,frame:this.animationFrame,timestamp:e}),this.waiting=!1),this.stop||(n<this.duration?requestAnimationFrame(t.bind(this)):n+this.last.last>this.duration?(this.animationFrame++,this.callback(this.keyframes.test(1),1,{lastFrame:this.lastFrameRate.last,currentTime:this.lastFrameRate.currenttime,frame:this.animationFrame,timestamp:e}),this.done=!0,this.loop&&requestAnimationFrame(t.bind(this)),this.next?.()):this.done||(this.done=!0,this.loop&&requestAnimationFrame(t.bind(this)),this.next?.())),0===this.animationFrame&&this.__start()}.bind(this)),this}finally(t){return this.next=t,this}break(){return this.stop=!1,this}listen(t,e){"start"===t&&this._start.then(e)}}class r{constructor(t,e){this.keyframes=[],this.run=[],t.every(((t,e)=>t instanceof r.keyframe&&!this.keyframes.some((e=>e.time===t.time))?(this.keyframes.push(t),!0):(console.error(new Error(`Invalid Keyframe ${e+1}!`)),!1))),this.keyframes.forEach((t=>this.run.push(t))),this.easing="function"!=typeof e?s[e]:e,this.nextTime()}nextTime(){if(!this.run.length)return this.next=null;this.run.length>1?(this.current=this.run.reduce(((t,e)=>e.time<t.time?e:t)),this.next=this.run.filter((t=>t.time!==this.current.time)).reduce(((t,e)=>e.time<t?e:t))):(this.restart(),this.next=this.run.reduce(((t,e)=>e.time<t.time?e:t))),this.run.shift()}restart(){for(;this.run.length;)this.run.pop();this.keyframes.forEach((t=>this.run.push(t)))}test(t){this.next.time<=t&&this.nextTime(),t=Math.min(this.easing(t),1);const e=this.next.val-this.current.val,i=this.next.time-this.current.time,s=e*t;return(this.current.val+s)/i}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}static keyframe=class{constructor(t,e){this.time=t,this.val=e}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}return i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(494)})()));
//# sourceMappingURL=algoframe.js.map